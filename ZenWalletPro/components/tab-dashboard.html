<div id="quick-templates-container" class="quick-actions-container d-none mb-3">
    </div>

<div class="grid-stack">
    
    <div class="grid-stack-item" gs-id="widget-total-assets" gs-x="0" gs-y="0" gs-w="5" gs-h="2" gs-min-w="3" gs-min-h="2">
        <div class="grid-stack-item-content dashboard-module" id="module-total-assets">
            <h4 class="module-title"><i class="bi bi-shield-check"></i> 總資產</h4>
            <div class="text-center py-3 flex-grow-1 d-flex flex-column justify-content-center">
                <div class="text-muted small">總資產淨值</div>
                <h2 class="fw-bold mb-0 sensitive" id="total-assets-display">$ 0</h2>
            </div>
        </div>
    </div>

    <div class="grid-stack-item" gs-id="widget-stats" gs-x="5" gs-y="0" gs-w="7" gs-h="2" gs-min-w="3" gs-min-h="2">
        <div class="grid-stack-item-content dashboard-module" id="module-stats">
            <h4 class="module-title"><i class="bi bi-calculator"></i> 期間統計</h4>
            <div class="row g-3 h-100 align-items-center">
                <div class="col-6">
                    <div class="stat-card">
                        <div class="stat-label">期間收入</div>
                        <div class="stat-value text-income sensitive" id="stat-income">$ 0</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stat-card">
                        <div class="stat-label">期間支出</div>
                        <div class="stat-value text-expense sensitive" id="stat-expense">$ 0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid-stack-item" gs-id="widget-cash-overview" gs-x="0" gs-y="2" gs-w="5" gs-h="5" gs-min-w="3" gs-min-h="4">
        <div class="grid-stack-item-content dashboard-module" id="module-cash-overview">
            <h4 class="module-title"><i class="bi bi-wallet-fill"></i> 現金帳戶</h4>
            <ul class="list-group list-group-flush small flex-grow-1 overflow-auto" id="account-balance-list">
                <li class="list-group-item text-muted text-center">計算中...</li>
            </ul>
            <button class="btn btn-info w-100 text-white mt-2" onclick="window.showTransferModal()">
                <i class="bi bi-arrow-left-right"></i> 資金移轉
            </button>
        </div>
    </div>

    <div class="grid-stack-item" gs-id="widget-trend" gs-x="5" gs-y="2" gs-w="7" gs-h="4" gs-min-w="4" gs-min-h="4">
        <div class="grid-stack-item-content dashboard-module" id="module-trend">
            <h4 class="module-title"><i class="bi bi-bar-chart-line-fill"></i> 收支趨勢</h4>
            <div style="position: relative; flex-grow: 1; min-height: 0;">
                <canvas id="trendChart"></canvas>
            </div>
        </div>
    </div>

    <div class="grid-stack-item" gs-id="widget-net-worth" gs-x="0" gs-y="13" gs-w="12" gs-h="4" gs-min-w="6" gs-min-h="4">
        <div class="grid-stack-item-content dashboard-module" id="module-net-worth">
            <h4 class="module-title"><i class="bi bi-graph-up"></i> 資產淨值歷史</h4>
            <div style="position: relative; flex-grow: 1; min-height: 0;">
                <canvas id="netWorthChart"></canvas>
            </div>
        </div>
    </div>

    <div class="grid-stack-item" gs-id="widget-pie-chart" gs-x="0" gs-y="7" gs-w="5" gs-h="4" gs-min-w="3" gs-min-h="4">
        <div class="grid-stack-item-content dashboard-module" id="module-pie-chart">
            <h4 class="module-title"><i class="bi bi-pie-chart-fill"></i> 支出類別</h4>
            <div style="position: relative; flex-grow: 1; min-height: 0;">
                <canvas id="categoryPieChart"></canvas>
            </div>
            <p id="pie-chart-no-data" class="text-center text-muted small mt-3 d-none">無支出資料</p>
        </div>
    </div>

    <div class="grid-stack-item" gs-id="widget-tags" gs-x="0" gs-y="17" gs-w="5" gs-h="5" gs-min-w="3" gs-min-h="4">
        <div class="grid-stack-item-content dashboard-module" id="module-tags">
            <h4 class="module-title"><i class="bi bi-tags-fill"></i> 標籤支出排行</h4>
            <div id="tag-analytics-list" class="list-group list-group-flush flex-grow-1 overflow-auto small">
                <div class="text-center text-muted py-3">載入中...</div>
            </div>
        </div>
    </div>

    <div class="grid-stack-item" gs-id="widget-transactions" gs-x="5" gs-y="6" gs-w="7" gs-h="7" gs-min-w="5" gs-min-h="6">
        <div class="grid-stack-item-content dashboard-module" id="module-transactions">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h4 class="module-title mb-0"><i class="bi bi-list-ul"></i> 近期交易</h4>
                <div class="d-flex gap-2">
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary" id="nav-prev"><i class="bi bi-chevron-left"></i></button>
                        <button class="btn btn-outline-secondary px-2" id="current-view-display" disabled>本月</button>
                        <button class="btn btn-outline-secondary" id="nav-next"><i class="bi bi-chevron-right"></i></button>
                    </div>
                    <button class="btn btn-sm btn-success" id="btn-open-stock-modal" title="購買股票">
                        <i class="bi bi-graph-up-arrow"></i>
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="document.getElementById('add-date').valueAsDate=new Date();" data-bs-toggle="collapse" data-bs-target="#collapseAddForm">
                        <i class="bi bi-plus-lg"></i>
                    </button>
                </div>
            </div>
            
            <div class="d-flex justify-content-end mb-2">
                <div class="btn-group btn-group-sm" role="group">
                    <input type="radio" class="btn-check" name="viewUnit" id="unit-year" autocomplete="off">
                    <label class="btn btn-outline-primary" for="unit-year">年</label>
                    <input type="radio" class="btn-check" name="viewUnit" id="unit-month" autocomplete="off" checked>
                    <label class="btn btn-outline-primary" for="unit-month">月</label>
                    <input type="radio" class="btn-check" name="viewUnit" id="unit-week" autocomplete="off">
                    <label class="btn btn-outline-primary" for="unit-week">週</label>
                    <input type="radio" class="btn-check" name="viewUnit" id="unit-day" autocomplete="off">
                    <label class="btn btn-outline-primary" for="unit-day">日</label>
                </div>
            </div>

            <div class="collapse mb-2" id="collapseAddForm">
                <div class="card card-body bg-light border-0 p-2">
                    <form id="addTransactionForm">
                        <div class="row g-2">
                            <div class="col-6"><input type="date" class="form-control form-control-sm" id="add-date" required></div>
                            <div class="col-6">
                                <select id="add-type" class="form-select form-select-sm" required>
                                    <option value="" disabled selected>類型</option>
                                    <option value="支出">支出</option>
                                    <option value="收入">收入</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <select id="add-category" class="form-select form-select-sm" disabled required>
                                    <option value="">類別</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <select id="add-account" class="form-select form-select-sm" required>
                                    <option value="">帳戶</option>
                                </select>
                            </div>
                            <div class="col-12"><input type="text" class="form-control form-control-sm" id="add-item" placeholder="項目" required></div>
                            
                            <div class="col-12">
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="add-amount" placeholder="總金額" step="any" required>
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" id="add-tags" placeholder="標籤">
                            </div>
                            
                            <div class="col-12"><textarea class="form-control form-control-sm" id="add-notes" rows="1" placeholder="備註"></textarea></div>
                            <div class="col-12"><button type="submit" class="btn btn-primary btn-sm w-100">新增</button></div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="mb-2">
                <div class="input-group input-group-sm mb-2">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="search-keyword" placeholder="搜尋項目或備註...">
                </div>
                <input type="hidden" id="filter-start-date"><input type="hidden" id="filter-end-date"><input type="hidden" id="filter-type"><input type="hidden" id="filter-category"><input type="hidden" id="filter-account"><input type="hidden" id="filter-tag">
                <button id="filter-btn" class="d-none"></button><button id="filter-clear-btn" class="d-none"></button>
            </div>
            
            <div id="transactionsList" class="list-group list-group-flush flex-grow-1 overflow-auto" style="min-height: 0;">
                <div class="text-center text-muted py-4">載入中...</div>
            </div>
        </div>
    </div>

</div>