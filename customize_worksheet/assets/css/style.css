/* assets/css/style.css */
body { font-family: "Microsoft JhengHei", sans-serif; margin: 0; padding: 20px; background: #f0f2f5; color: #333; }
.control-panel { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin: 0 auto 30px; max-width: 1000px; position: relative; }

/* Stepper */
.stepper-container { display: flex; justify-content: center; align-items: center; margin-bottom: 30px; }
.step-indicator { display: flex; flex-direction: column; align-items: center; opacity: 0.5; transition: 0.3s; position: relative; z-index: 1; }
.step-indicator.active, .step-indicator.completed { opacity: 1; }
.circle { width: 32px; height: 32px; background: #e0e0e0; color: #666; border-radius: 50%; text-align: center; line-height: 32px; font-weight: bold; margin-bottom: 5px; }
.active .circle { background: #2196F3; color: white; transform: scale(1.1); }
.completed .circle { background: #4CAF50; color: white; }
.label { font-size: 13px; color: #999; }
.active .label { color: #2196F3; font-weight: bold; }
.line { flex: 1; height: 2px; background: #e0e0e0; margin: -20px 10px 0; max-width: 100px; }

/* Smart Editor */
.smart-editor-container { border: 1px solid #ddd; border-radius: 8px; background: white; display: flex; flex-direction: column; height: 550px; }
.smart-editor-container.compact { height: 250px; }
.editor-toolbar { background: #f8f9fa; border-bottom: 1px solid #ddd; padding: 8px 15px; display: flex; gap: 8px; align-items: center; }
.btn-tool { background: white; border: 1px solid #ccc; padding: 6px 12px; border-radius: 4px; font-size: 13px; cursor: pointer; }
.btn-ai-gradient { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; font-weight: bold; }
.editor-main { display: flex; flex: 1; overflow: hidden; }
.editor-pane { flex: 1; display: flex; flex-direction: column; }
.input-pane { border-right: 1px solid #ddd; }
.pane-label { background: #f1f3f4; padding: 6px 15px; font-size: 12px; font-weight: bold; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
textarea { flex: 1; border: none; padding: 15px; resize: none; outline: none; font-size: 14px; line-height: 1.6; }
.preview-content { flex: 1; overflow-y: auto; padding: 15px; }

/* Parsed Items */
.parsed-item { border: 1px solid #e0e0e0; border-left: 4px solid #ccc; padding: 10px; margin-bottom: 8px; border-radius: 4px; background: white; }
.parsed-item:hover { border-color: #2196F3; transform: translateX(2px); }
.parsed-item.has-expl { border-left-color: #4CAF50; }
.parsed-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px; }
.parsed-id { color: #1976D2; font-weight: bold; }
.item-toolbar { margin-top: 8px; padding-top: 8px; border-top: 1px dashed #eee; display: flex; gap: 5px; opacity: 0.6; }
.parsed-item:hover .item-toolbar { opacity: 1; }
.btn-xs { padding: 2px 8px; font-size: 11px; border-radius: 10px; border: 1px solid #ccc; cursor: pointer; background: white; }

/* Mode Tabs */
.mode-tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 20px; }
.mode-tab { flex: 1; padding: 12px; border: none; background: none; border-bottom: 3px solid transparent; cursor: pointer; font-size: 15px; color: #666; }
.mode-tab.active { border-bottom-color: #2196F3; color: #2196F3; font-weight: bold; }

/* Buttons & Navigation */
.nav-buttons { display: flex; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
.nav-buttons.right { justify-content: flex-end; }
.nav-buttons.split { justify-content: space-between; }
.btn-primary { background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
.btn-secondary { background: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb; padding: 8px 15px; border-radius: 6px; cursor: pointer; }
.generation-area { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
.btn-lg-primary { background: #2196F3; color: white; padding: 12px 30px; font-size: 16px; font-weight: bold; border-radius: 6px; border: none; cursor: pointer; }
.btn-lg-secondary { background: #607d8b; color: white; padding: 12px 20px; font-size: 16px; border-radius: 6px; border: none; cursor: pointer; }

/* Modal */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000; }
.modal-content { background: white; width: 90%; max-width: 600px; border-radius: 8px; max-height: 90vh; display: flex; flex-direction: column; }
.modal-header { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; background: #f9f9f9; }
.modal-body { padding: 20px; overflow-y: auto; flex: 1; }
.modal-footer { padding: 15px; text-align: right; background: #f9f9f9; border-top: 1px solid #eee; }
.close-modal { font-size: 24px; cursor: pointer; }

/* Output & Print */
#output-area { background: white; max-width: 210mm; margin: 0 auto; min-height: 297mm; padding: 20mm; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
@media print {
    .control-panel, .modal { display: none !important; }
    #output-area { width: 100%; padding: 0; box-shadow: none; }
    .answer-sheet-page { page-break-after: always; width: 100%; height: 100vh; }
    .cut-line { text-align: center; border-top: 1px dashed #ccc; margin: 20px 0; font-size: 10px; color: #999; }
}

/* Answer Sheet Specific */
.answer-sheet-card { border: 2px solid #333; border-radius: 8px; padding: 15px; background: white; margin-bottom: 20px; }
.as-header { border-bottom: 2px solid #333; display: flex; justify-content: space-between; padding-bottom: 10px; margin-bottom: 15px; }
.as-body { display: flex; gap: 20px; }
.seat-section { width: 120px; border-right: 1px solid #ccc; padding-right: 15px; }
.seat-grid { display: flex; justify-content: space-around; }
.bubble-row { display: flex; align-items: center; margin-bottom: 4px; }
.bubble-circle { width: 16px; height: 12px; border: 1px solid #333; border-radius: 50%; }
.question-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px 20px; }
.q-row { display: flex; align-items: center; border-bottom: 1px solid #f0f0f0; }
.q-options { display: flex; gap: 5px; }
.bubble-opt { width: 18px; height: 18px; border: 1px solid #999; border-radius: 50%; text-align: center; font-size: 10px; line-height: 18px; color: #ccc; }

/* 編輯模式表單樣式 */
.form-group {margin-bottom: 15px;}
.form-group label {display: block;font-weight: bold;margin-bottom: 5px;color: #555;}
.input-field {width: 100%;padding: 8px;border: 1px solid #ddd;border-radius: 4px;font-size: 14px;font-family: inherit;box-sizing: border-box; /* 確保 padding 不會撐破寬度 */}
.input-field:focus {border-color: #2196F3;outline: none;}

/* 預覽區的編輯按鈕 */
.parsed-actions {position: absolute; /* 絕對定位在卡片右上角 */top: 10px;right: 10px;display: flex;gap: 5px;}
.btn-icon-small {background: #fff;border: 1px solid #ddd;cursor: pointer;padding: 4px 8px;border-radius: 4px;font-size: 14px;transition: all 0.2s;}
.btn-icon-small:hover {background: #f0f0f0;color: #2196F3;border-color: #2196F3;}
.parsed-item {position: relative; /* 讓 actions 可以定位 */}

/* =========================================
   V15 新架構樣式 (Dashboard Layout)
   ========================================= */

/* 1. 全域設定 */
body {display: flex;flex-direction: column;height: 100vh;overflow: hidden; /* 防止雙重捲軸 */}

/* 2. 頂部導航列 */
.app-header {height: 60px;background: #fff;border-bottom: 1px solid #ddd;display: flex;align-items: center;justify-content: space-between;padding: 0 20px;box-shadow: 0 2px 5px rgba(0,0,0,0.05);z-index: 50;}
.app-header h1 { margin: 0; font-size: 1.2rem; }
.header-actions { display: flex; align-items: center; gap: 10px; }
.btn-primary-action {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);color: white; border: none; padding: 8px 20px; border-radius: 20px;font-weight: bold; cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.15);}
.btn-primary-action:hover { transform: translateY(-1px); box-shadow: 0 5px 10px rgba(0,0,0,0.2); }
.divider-v { width: 1px; height: 24px; background: #eee; margin: 0 5px; }
.btn-icon { background: none; border: 1px solid #ddd; border-radius: 50%; width: 36px; height: 36px; cursor: pointer; font-size: 1.2rem; }
.btn-icon:hover { background: #f5f5f5; }

/* 3. 主工作區 */
.main-workspace {flex: 1; /* 佔滿剩餘空間 */overflow-y: auto; /* 內容過長可捲動 */padding: 20px;padding-bottom: 60px; /* 預留底部面板把手的高度 */background: #f8f9fa;}

/* 4. 底部成績面板 (Drawer) */
.bottom-panel {position: fixed;bottom: 0;left: 0;width: 100%;background: #fff;box-shadow: 0 -2px 10px rgba(0,0,0,0.1);transition: transform 0.3s ease-in-out;z-index: 100;border-top-left-radius: 15px;border-top-right-radius: 15px;}

/* 收合狀態：只露出把手 (40px高) */
.bottom-panel.collapsed {transform: translateY(calc(100% - 40px)); }

/* 展開狀態 */
.bottom-panel.expanded {transform: translateY(0);}

/* 把手區域 */
.panel-handle {height: 40px;background: #e3f2fd; /* 淺藍色底 */color: #1565c0;display: flex;align-items: center;justify-content: center;cursor: pointer;font-weight: bold;border-top-left-radius: 15px;border-top-right-radius: 15px;user-select: none;}
.panel-handle:hover { background: #bbdefb; }

.panel-content {height: 300px; /* 展開後的高度 */padding: 15px 20px;display: flex;flex-direction: column;gap: 10px;}

.badge {background: #1565c0; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 10px;}

.grading-toolbar { display: flex; gap: 10px; margin-bottom: 5px; }
.grading-input-area { flex: 1; }
.grading-input-area textarea {width: 100%; height: 100%; resize: none; border: 1px solid #ddd;border-radius: 8px; padding: 10px; font-family: monospace;}

/* 隱藏舊的元素 (以防萬一) */
.control-panel, .stepper-container { display: none !important; }

/* =========================================
   V16: 預覽與列印專用樣式
   ========================================= */

/* 1. 預覽區 (模擬 A4 紙張) */
.paper-preview {background: white;width: 210mm; /* A4 標準寬度 */min-height: 297mm; /* A4 最小高度 */margin: 0 auto;padding: 20mm; /* 模擬列印邊距 */box-shadow: 0 0 15px rgba(0,0,0,0.5); /* 立體陰影 */box-sizing: border-box;overflow: hidden; /* 內容若溢出則隱藏 (避免破版) */}

/* 2. 列印時的顯示控制 (Magic Print Styles) */
@media print {/* 隱藏網頁上所有元素 */body * {visibility: hidden;}

    /* 只顯示預覽 Modal 和裡面的 output-area */#modal-print-preview,#output-area,#output-area * {visibility: visible;}
    
    /* 強制 Modal 佔滿全螢幕並移除背景/邊框 */
    #modal-print-preview {position: absolute;left: 0;top: 0;width: 100%;height: auto;background: none !important;display: block !important; /* 確保它是顯示的 */overflow: visible !important;z-index: 9999;}

    /* 移除 Modal 的外框裝飾 */
    .modal-content {
        box-shadow: none !important;border: none !important;width: 100% !important;max-width: none !important;height: auto !important;margin: 0 !important;padding: 0 !important;background: none !important;}

    /* 隱藏 Modal 的 Header 和 Footer */
    .modal-header, .modal-footer {display: none !important;}

    /* 確保 Body 內容可見 */
    .modal-body {
        display: block !important;padding: 0 !important;background: none !important;overflow: visible !important;}
    
    /* 設定紙張位置 */
    #output-area {position: absolute;left: 0;top: 0;width: 100%;margin: 0;box-shadow: none !important; /* 列印時不要陰影 */padding: 0; /* 列印時通常由 @page 控制邊距，或保持預設 */}
}

/* =========================================
   V17 Tab Layout Styles
   ========================================= */

/* Tab Navigation */
.tab-nav {display: flex;background: #f0f2f5;padding: 10px 20px 0;border-bottom: 1px solid #ddd;gap: 5px;}

.tab-btn {padding: 10px 20px;border: 1px solid transparent;border-bottom: none;border-radius: 8px 8px 0 0;background: transparent;cursor: pointer;font-size: 1rem;color: #666;transition: all 0.2s;}

.tab-btn:hover {background: #e4e6eb;color: #333;}

.tab-btn.active {background: #fff;border-color: #ddd;color: #1565c0;font-weight: bold;box-shadow: 0 -2px 5px rgba(0,0,0,0.02);}

/* Tab Content */
.tab-container {flex: 1;overflow: hidden;position: relative;background: #fff;}

.tab-content {display: none;height: 100%;overflow-y: auto;padding: 20px;animation: fadeIn 0.3s ease;}

.tab-content.active {display: block;}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Export Dashboard (Tab 2) */
.export-dashboard {display: flex;justify-content: center;gap: 30px;margin-top: 40px;flex-wrap: wrap;}

.export-card {background: #fff;border: 1px solid #eee;border-radius: 12px;padding: 30px;width: 250px;text-align: center;box-shadow: 0 4px 15px rgba(0,0,0,0.05);transition: transform 0.2s;}

.export-card:hover {transform: translateY(-5px);box-shadow: 0 8px 20px rgba(0,0,0,0.1);}

.card-icon { font-size: 3rem; margin-bottom: 15px; }
.export-card h3 { margin: 0 0 10px 0; color: #333; }
.export-card p { color: #777; font-size: 0.9em; margin-bottom: 20px; height: 40px; }

/* Grading Layout (Tab 3) */
.grading-layout {max-width: 800px;margin: 0 auto;display: flex;flex-direction: column;gap: 20px;height: 100%;}

.grading-tools-panel, .remedial-action-panel {background: #f8f9fa;border: 1px solid #eee;border-radius: 10px;padding: 20px;}

.grading-tools-panel {flex: 1;display: flex;flex-direction: column;}

.panel-label {font-weight: bold; color: #444; margin-bottom: 10px; border-left: 4px solid #1565c0; padding-left: 10px;}

.grading-input-wrapper { flex: 1; margin-top: 10px; }
.grading-input-wrapper textarea {width: 100%; height: 100%; resize: none; border: 1px solid #ddd;border-radius: 8px; padding: 10px; font-family: monospace;}

.status-bar {text-align: right; font-size: 0.85em; color: #666; margin-top: 5px;}