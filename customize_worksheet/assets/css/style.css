/* =========================================
   ğŸ“ è€ƒå·æ•¸ä½åŠ©æ•™ - Main Stylesheet (Cleaned)
   æ¶æ§‹ï¼šV18 Tab Layout + Info Bar
   ========================================= */

/* 1. å…¨åŸŸè¨­å®š (Global & Layout) */
body {
    font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
    margin: 0;
    padding: 0;
    background: #f8f9fa;
    color: #333;
    height: 100vh; /* ä½”æ»¿è¦–çª—é«˜åº¦ */
    display: flex;
    flex-direction: column; /* å‚ç›´æ’åˆ—ï¼šHeader -> Nav -> Info -> Content */
    overflow: hidden; /* é˜²æ­¢æ•´å€‹é é¢å‡ºç¾é›™é‡æ²è»¸ */
}

/* é€šç”¨æŒ‰éˆ•æ¨£å¼ */
button { font-family: inherit; }
.btn-tool { background: white; border: 1px solid #ccc; padding: 6px 12px; border-radius: 4px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
.btn-tool:hover { background: #f5f5f5; border-color: #bbb; }
.btn-tool.text-danger { color: #d32f2f; border-color: #ffcdd2; }
.btn-tool.text-danger:hover { background: #ffebee; }

.btn-primary { background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
.btn-primary:hover { background: #1976D2; }
.btn-secondary { background: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb; padding: 8px 15px; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
.btn-secondary:hover { background: #bbdefb; }

.btn-ai-gradient { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; font-weight: bold; }
.btn-ai-gradient:hover { opacity: 0.9; box-shadow: 0 2px 5px rgba(16, 185, 129, 0.3); }

/* 2. é ‚éƒ¨ Header */
.app-header {
    height: 50px;
    background: #fff;
    border-bottom: 1px solid #ddd;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.02);
    z-index: 50;
    flex-shrink: 0; /* é˜²æ­¢è¢«å£“ç¸® */
}
.app-header h1 { margin: 0; font-size: 1.1rem; color: #333; }
.header-actions { display: flex; align-items: center; gap: 10px; }
.btn-icon { background: none; border: 1px solid #ddd; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; }
.btn-icon:hover { background: #f5f5f5; color: #2196F3; border-color: #2196F3; }

/* 3. åˆ†é å°èˆªåˆ— (Tab Navigation) */
.tab-nav {
    display: flex;
    background: #f8f9fa;
    padding: 10px 20px 0;
    border-bottom: 1px solid #ddd;
    gap: 5px;
    flex-shrink: 0;
}
.tab-btn {
    padding: 10px 25px;
    border: 1px solid transparent;
    border-bottom: none;
    border-radius: 8px 8px 0 0;
    background: transparent;
    cursor: pointer;
    font-size: 0.95rem;
    color: #666;
    transition: all 0.2s;
}
.tab-btn:hover { background: #e9ecef; color: #333; }
.tab-btn.active {
    background: #fff;
    border-color: #ddd;
    color: #1565c0;
    font-weight: bold;
    box-shadow: 0 -2px 5px rgba(0,0,0,0.02);
    position: relative;
    top: 1px; /* è“‹ä½åº•ç·š */
}

/* 4. è©¦å·è³‡è¨Šåˆ— (Info Bar) */
.exam-info-bar {
    background: #e3f2fd;
    /* [ä¿®æ”¹] ä¾ç…§éœ€æ±‚èª¿æ•´é–“è· */
    margin: 0 20px;       /* å…©å´ç•™ç™½ */
    padding: 8px 10px;    /* ä¸Šä¸‹ 8pxï¼Œå·¦å³ç¨å¾®ç•™ 10px ç·©è¡ï¼Œé¿å…æ–‡å­—è²¼é½Šé‚Šç·£å¤ªæ“  */
    display: flex;
    align-items: center;
    gap: 20px;
    font-size: 0.9rem;
    color: #1565c0;
    flex-shrink: 0;
    /* è®“æµ®å‹•æ¢çœ‹èµ·ä¾†æ›´ç²¾ç·» */
    border-radius: 0px;   
    border: 1px solid #bbdefb;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.info-group { display: flex; align-items: center; }
.info-icon { font-size: 1.1rem; margin-right: 5px; }
.info-label { font-weight: bold; margin-right: 5px; }
.info-value { font-weight: bold; color: #0d47a1; }
.info-unit { margin-left: 2px; font-size: 0.9em; }

#current-exam-title {
    background: transparent; border: none; border-bottom: 2px solid transparent;
    color: #0d47a1; font-weight: bold; font-size: 0.95rem; padding: 2px 5px; width: 250px;
    transition: all 0.2s;
}
#current-exam-title:hover { border-bottom-color: #90caf9; background: rgba(255,255,255,0.5); }
#current-exam-title:focus { outline: none; border-bottom-color: #1565c0; background: white; }

/* 5. åˆ†é å…§å®¹å®¹å™¨ */
.tab-container {
    flex: 1; /* ä½”æ»¿å‰©é¤˜é«˜åº¦ */
    overflow: hidden; /* å…§éƒ¨æ»¾å‹• */
    position: relative;
    background: #fff;
}
.tab-content {
    display: none;
    height: 100%;
    overflow-y: auto; /* å…§å®¹éé•·æ™‚å‡ºç¾å·è»¸ */
    padding: 20px;
    box-sizing: border-box;
    animation: fadeIn 0.3s ease;
}
.tab-content.active { display: block; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}

/* =========================================
   Tab 1: å»ºç«‹é¡Œåº« (Smart Editor)
   ========================================= */
.smart-editor-container {
    border: 1px solid #ddd; border-radius: 8px; background: white;
    display: flex; flex-direction: column; height: 100%; /* ä½”æ»¿ Tab é«˜åº¦ */
}
.editor-toolbar {
    background: #f8f9fa; border-bottom: 1px solid #ddd; padding: 8px 15px;
    display: flex; gap: 8px; align-items: center; flex-shrink: 0;
}
.toolbar-divider { width: 1px; height: 20px; background: #ddd; margin: 0 5px; }
.editor-main { display: flex; flex: 1; overflow: hidden; }
.editor-pane { flex: 1; display: flex; flex-direction: column; min-width: 0; /* é˜²æ­¢ flex item æº¢å‡º */ }
.input-pane { border-right: 1px solid #ddd; }
.pane-label {
    background: #f1f3f4; padding: 8px 15px; font-size: 12px; font-weight: bold;
    border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;
    color: #555;
}
textarea#txt-raw-q {
    flex: 1; border: none; padding: 15px; resize: none; outline: none;
    font-size: 14px; line-height: 1.6; font-family: monospace;
}
.preview-content { flex: 1; overflow-y: auto; padding: 15px; background: #fafafa; }
.empty-state { text-align: center; color: #aaa; margin-top: 50px; font-size: 14px; }

/* Parsed Item (é è¦½å¡ç‰‡) */
.parsed-item {
    border: 1px solid #e0e0e0; border-left: 4px solid #ccc; padding: 10px; margin-bottom: 10px;
    border-radius: 4px; background: white; position: relative; transition: all 0.2s;
}
.parsed-item:hover { border-color: #2196F3; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
.parsed-item.has-expl { border-left-color: #4CAF50; }
.parsed-header {
    display: flex;
    justify-content: flex-start; /* æ”¹ç‚ºé å·¦å°é½Š */
    align-items: center;         /* å‚ç›´ç½®ä¸­ */
    gap: 10px;                   /* é¡Œè™Ÿèˆ‡æ¨™ç±¤ä¹‹é–“çš„é–“è· */
    font-size: 12px;
    margin-bottom: 5px;
    color: #888;
    padding-right: 60px;         /* [é—œéµ] å³å´é ç•™ç©ºé–“çµ¦ç·¨è¼¯æŒ‰éˆ• */
}
.parsed-id { color: #1976D2; font-weight: bold; }
.parsed-badge { background: #eee; padding: 1px 6px; border-radius: 4px; font-size: 10px; }
.parsed-text { font-size: 14px; line-height: 1.4; color: #333; padding-right: 50px; /* é¿é–‹æŒ‰éˆ• */ }
.parsed-actions { position: absolute; top: 8px; right: 8px; display: flex; gap: 4px; opacity: 0.6; transition: opacity 0.2s; }
.parsed-item:hover .parsed-actions { opacity: 1; }
.btn-icon-small {
    background: white; border: 1px solid #ddd; padding: 2px 6px; border-radius: 4px; font-size: 12px; cursor: pointer;
}
.btn-icon-small:hover { border-color: #2196F3; color: #2196F3; }

/* =========================================
   Tab 2: è€ƒå‰è¼¸å‡º (Export Dashboard)
   ========================================= */
.export-dashboard {
    display: flex; justify-content: center; gap: 30px; margin-top: 60px; flex-wrap: wrap;
}
.export-card {
    background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 40px 30px;
    width: 260px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    transition: transform 0.2s, box-shadow 0.2s;
}
.export-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); border-color: #2196F3; }
.card-icon { font-size: 3.5rem; margin-bottom: 20px; display: block; }
.export-card h3 { margin: 0 0 10px 0; color: #333; font-size: 1.2rem; }
.export-card p { color: #666; font-size: 0.9rem; margin-bottom: 25px; line-height: 1.5; height: 40px; }
.btn-primary-action {
    color: white; border: none; padding: 10px 25px; border-radius: 25px; font-weight: bold;
    cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.15); font-size: 0.95rem; transition: all 0.2s;
}
.btn-primary-action:hover { transform: translateY(-1px); box-shadow: 0 5px 12px rgba(0,0,0,0.2); opacity: 0.9; }

/* =========================================
   Tab 3: é–±å·èˆ‡è£œæ•‘ (Grading Layout)
   ========================================= */
.grading-layout {
    max-width: 900px; margin: 0 auto; display: flex; flex-direction: column; gap: 20px; height: 100%;
}
.grading-tools-panel, .remedial-action-panel {
    background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 10px; padding: 20px;
}
.grading-tools-panel { flex: 1; display: flex; flex-direction: column; min-height: 300px; }
.panel-label {
    font-weight: bold; color: #444; margin-bottom: 15px; border-left: 4px solid #1565c0; padding-left: 10px; font-size: 1.1rem;
}
.grading-toolbar { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
.grading-input-wrapper { flex: 1; border: 1px solid #ddd; border-radius: 8px; background: white; padding: 10px; }
textarea#txt-raw-s {
    width: 100%; height: 100%; border: none; resize: none; outline: none; font-family: monospace; font-size: 14px;
}
.status-bar { text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-weight: bold; }
.btn-lg-primary {
    background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white;
    width: 100%; padding: 15px; font-size: 1.2rem; font-weight: bold; border: none; border-radius: 8px;
    cursor: pointer; box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3); transition: all 0.2s;
}
.btn-lg-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(33, 150, 243, 0.4); }

/* =========================================
   Modals (å½ˆå‡ºè¦–çª—)
   ========================================= */
.modal {
    display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000;
}
.modal-content {
    background: white; width: 90%; max-width: 600px; border-radius: 8px;
    max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}
.modal-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fafafa; border-radius: 8px 8px 0 0; }
.modal-header h2 { margin: 0; font-size: 1.2rem; color: #333; }
.close-modal { font-size: 24px; cursor: pointer; color: #999; }
.close-modal:hover { color: #333; }
.modal-body { padding: 20px; overflow-y: auto; flex: 1; }
.modal-footer { padding: 15px 20px; text-align: right; background: #fafafa; border-top: 1px solid #eee; border-radius: 0 0 8px 8px; display: flex; justify-content: flex-end; gap: 10px; }

/* ç·¨è¼¯æ¨¡å¼è¡¨å–® */
.form-group { margin-bottom: 15px; }
.form-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; font-size: 0.9rem; }
.input-field {
    width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px;
    font-size: 14px; font-family: inherit; box-sizing: border-box;
}
.input-field:focus { border-color: #2196F3; outline: none; }

/* =========================================
   Print Preview & Media Query
   (è¨»ï¼šè©³ç´°çš„ç´™å¼µæ’ç‰ˆç”± worksheetStyle.css æ§åˆ¶ï¼Œé€™è£¡åªè² è²¬éš±è— UI)
   ========================================= */
@media print {
    body * { visibility: hidden; } /* éš±è—æ‰€æœ‰å…ƒç´  */
    
    /* åªé¡¯ç¤ºé è¦½è¦–çª—å…§å®¹ */
    #modal-print-preview, #modal-print-preview * { visibility: visible; }
    
    /* é‡ç½® Modal ä½ç½®ï¼Œä½¿å…¶å¡«æ»¿ç´™å¼µ */
    #modal-print-preview {
        position: absolute; left: 0; top: 0; width: 100%; height: auto;
        background: white !important; display: block !important; z-index: 9999;
    }
    .modal-content {
        box-shadow: none !important; border: none !important; margin: 0 !important;
        width: 100% !important; max-width: 100% !important; padding: 0 !important;
    }
    .modal-header, .modal-footer, .close-modal { display: none !important; }
    .modal-body { padding: 0 !important; background: white !important; overflow: visible !important; }
}

/* =========================================
   V23: ç©ºç™½ç­”æ¡ˆå¡å°ˆç”¨æ¨£å¼ (Answer Sheet)
   ========================================= */

/* ç­”æ¡ˆå¡é é¢å®¹å™¨ */
.sheet-page {
    width: 100%;
    height: 100%;       /* æ’æ»¿çˆ¶å®¹å™¨ (A4 ç´™å¼µ) */
    background: white;  /* [é—œéµä¿®æ­£] å¼·åˆ¶èƒŒæ™¯ç´”ç™½ */
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    position: relative;
}
/* ç·Šæ¹Šæ¨¡å¼ï¼šä¸Šä¸‹å„åŠ */
.sheet-half {
    flex: 1; /* è‡ªå‹•å¹³åˆ†ä¸Šä¸‹é«˜åº¦ */
    overflow: hidden;
    padding: 10px 0;
    display: flex;
    flex-direction: column;
}
/* åˆ†éš”ç·š */
.sheet-divider {
    height: 0;
    border-bottom: 2px dashed #999;
    margin: 5px 0;
    position: relative;
    flex-shrink: 0;
}
.sheet-divider::after {
    content: 'âœ‚ï¸ è«‹æ²¿è™›ç·šå‰ªé–‹';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 0 10px;
    color: #999;
    font-size: 12px;
}
/* è¡¨æ ¼èˆ‡æ°£æ³¡æ¨£å¼ */
.ans-header { 
    display: flex; justify-content: space-between; border-bottom: 2px solid #000; 
    margin-bottom: 15px; padding-bottom: 5px; font-family: sans-serif;
}
.ans-header-title { 
    font-size: 1.4em; 
    font-weight: bold;
    
    /* [æ–°å¢] å¼·åˆ¶å–®è¡Œï¼Œè¶…å‡ºé¡¯ç¤ºåˆªç¯€è™Ÿ (...) */
    white-space: nowrap; 
    overflow: hidden;
    text-overflow: ellipsis;
    
    /* ç¢ºä¿æ¨™é¡Œä¸æœƒä½”æ“šéå¤šå¯¬åº¦ï¼Œä¿ç•™ç©ºé–“çµ¦å³å´è³‡è¨Šæ¬„ */
    flex: 1; 
    margin-right: 10px;
}
.ans-header-info { text-align: right; }

.ans-table { width: 100%; border-collapse: collapse; font-size: 14px; }
.ans-table td { padding: 4px; text-align: center; }

/* ç•«è¨˜åœ“åœˆ */
.bubble { 
    width: 24px; height: 24px; border: 1px solid #333; border-radius: 50%; 
    display: flex; align-items: center; justify-content: center; 
    color: #ccc; font-size: 0.8em; margin: 0 auto;
}
.info-box { 
    border: 1px solid #333; width: 80px; height: 24px; 
    display: inline-block; vertical-align: bottom; margin-left: 5px; 
}

/* ç·Šæ¹Šæ¨¡å¼å¾®èª¿ (å­—é«”ç¸®å°) */
.sheet-page.compact .ans-table { font-size: 12px; }
.sheet-page.compact .bubble { width: 20px; height: 20px; font-size: 0.7em; }
.sheet-page.compact .ans-header { margin-bottom: 10px; }
.sheet-page.compact .ans-header-title { font-size: 1.2em; }

@media print {
    .sheet-page {
        height: 100vh; /* åˆ—å°æ™‚å¼·åˆ¶ä½”æ»¿ä¸€é  */
        page-break-after: always;
        background: white !important; /* å†æ¬¡ç¢ºä¿åˆ—å°æ™‚ä¹Ÿæ˜¯ç™½çš„ */
    }
}